
<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <title>Goal: extracting all researchers affiliated to a certain university, who published in a specific time-frame &#8212; Dimensions API Lab - Reusable Code Solutions</title>
    <link rel="stylesheet" href="../../_static/nature.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../_static/css/custom.css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <script type="text/javascript" src="../../_static/language_data.js"></script>
    <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Searching GRID organizations using the Dimensions API" href="../organizations/GRID-preview.html" />
    <link rel="prev" title="Working with Pandas dataframes" href="../getting-started/4-Using-Dimcli-to-return-pandas-dataframes.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../organizations/GRID-preview.html" title="Searching GRID organizations using the Dimensions API"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="../getting-started/4-Using-Dimcli-to-return-pandas-dataframes.html" title="Working with Pandas dataframes"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">Dimensions API Lab - Reusable Code Solutions</a> &#187;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  
<style>
/* CSS for nbsphinx extension */

/* remove conflicting styling from Sphinx themes */
div.nbinput,
div.nbinput div.prompt,
div.nbinput div.input_area,
div.nbinput div[class*=highlight],
div.nbinput div[class*=highlight] pre,
div.nboutput,
div.nbinput div.prompt,
div.nbinput div.output_area,
div.nboutput div[class*=highlight],
div.nboutput div[class*=highlight] pre {
    background: none;
    border: none;
    padding: 0 0;
    margin: 0;
    box-shadow: none;
}

/* avoid gaps between output lines */
div.nboutput div[class*=highlight] pre {
    line-height: normal;
}

/* input/output containers */
div.nbinput,
div.nboutput {
    display: -webkit-flex;
    display: flex;
    align-items: flex-start;
    margin: 0;
    width: 100%;
}
@media (max-width: 540px) {
    div.nbinput,
    div.nboutput {
        flex-direction: column;
    }
}

/* input container */
div.nbinput {
    padding-top: 5px;
}

/* last container */
div.nblast {
    padding-bottom: 5px;
}

/* input prompt */
div.nbinput div.prompt pre {
    color: #307FC1;
}

/* output prompt */
div.nboutput div.prompt pre {
    color: #BF5B3D;
}

/* all prompts */
div.nbinput div.prompt,
div.nboutput div.prompt {
    min-width: 5ex;
    padding-top: 0.4em;
    padding-right: 0.4em;
    text-align: right;
    flex: 0;
}
@media (max-width: 540px) {
    div.nbinput div.prompt,
    div.nboutput div.prompt {
        text-align: left;
        padding: 0.4em;
    }
    div.nboutput div.prompt.empty {
        padding: 0;
    }
}

/* disable scrollbars on prompts */
div.nbinput div.prompt pre,
div.nboutput div.prompt pre {
    overflow: hidden;
}

/* input/output area */
div.nbinput div.input_area,
div.nboutput div.output_area {
    padding: 0.4em;
    -webkit-flex: 1;
    flex: 1;
    overflow: auto;
}
@media (max-width: 540px) {
    div.nbinput div.input_area,
    div.nboutput div.output_area {
        width: 100%;
    }
}

/* input area */
div.nbinput div.input_area {
    border: 1px solid #e0e0e0;
    border-radius: 2px;
    background: #f5f5f5;
}

/* override MathJax center alignment in output cells */
div.nboutput div[class*=MathJax] {
    text-align: left !important;
}

/* override sphinx.ext.imgmath center alignment in output cells */
div.nboutput div.math p {
    text-align: left;
}

/* standard error */
div.nboutput div.output_area.stderr {
    background: #fdd;
}

/* ANSI colors */
.ansi-black-fg { color: #3E424D; }
.ansi-black-bg { background-color: #3E424D; }
.ansi-black-intense-fg { color: #282C36; }
.ansi-black-intense-bg { background-color: #282C36; }
.ansi-red-fg { color: #E75C58; }
.ansi-red-bg { background-color: #E75C58; }
.ansi-red-intense-fg { color: #B22B31; }
.ansi-red-intense-bg { background-color: #B22B31; }
.ansi-green-fg { color: #00A250; }
.ansi-green-bg { background-color: #00A250; }
.ansi-green-intense-fg { color: #007427; }
.ansi-green-intense-bg { background-color: #007427; }
.ansi-yellow-fg { color: #DDB62B; }
.ansi-yellow-bg { background-color: #DDB62B; }
.ansi-yellow-intense-fg { color: #B27D12; }
.ansi-yellow-intense-bg { background-color: #B27D12; }
.ansi-blue-fg { color: #208FFB; }
.ansi-blue-bg { background-color: #208FFB; }
.ansi-blue-intense-fg { color: #0065CA; }
.ansi-blue-intense-bg { background-color: #0065CA; }
.ansi-magenta-fg { color: #D160C4; }
.ansi-magenta-bg { background-color: #D160C4; }
.ansi-magenta-intense-fg { color: #A03196; }
.ansi-magenta-intense-bg { background-color: #A03196; }
.ansi-cyan-fg { color: #60C6C8; }
.ansi-cyan-bg { background-color: #60C6C8; }
.ansi-cyan-intense-fg { color: #258F8F; }
.ansi-cyan-intense-bg { background-color: #258F8F; }
.ansi-white-fg { color: #C5C1B4; }
.ansi-white-bg { background-color: #C5C1B4; }
.ansi-white-intense-fg { color: #A1A6B2; }
.ansi-white-intense-bg { background-color: #A1A6B2; }

.ansi-default-inverse-fg { color: #FFFFFF; }
.ansi-default-inverse-bg { background-color: #000000; }

.ansi-bold { font-weight: bold; }
.ansi-underline { text-decoration: underline; }

/* Some additional styling taken form the Jupyter notebook CSS */
div.rendered_html table {
  border: none;
  border-collapse: collapse;
  border-spacing: 0;
  color: black;
  font-size: 12px;
  table-layout: fixed;
}
div.rendered_html thead {
  border-bottom: 1px solid black;
  vertical-align: bottom;
}
div.rendered_html tr,
div.rendered_html th,
div.rendered_html td {
  text-align: right;
  vertical-align: middle;
  padding: 0.5em 0.5em;
  line-height: normal;
  white-space: normal;
  max-width: none;
  border: none;
}
div.rendered_html th {
  font-weight: bold;
}
div.rendered_html tbody tr:nth-child(odd) {
  background: #f5f5f5;
}
div.rendered_html tbody tr:hover {
  background: rgba(66, 165, 245, 0.2);
}
</style>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>You can open an interactive version of this notebook in <a class="reference external" href="https://colab.research.google.com/github/digital-science/dimensions-api-lab/blob/master/notebooks/researchers/Researchers-Search-tips.ipynb">Google Colab</a>, or download its source from <a class="reference external" href="https://digital-science.github.io/dimensions-api-lab/blob/master/notebooks/researchers/Researchers-Search-tips.ipynb">Github</a>.</p>
</div>
<hr class="docutils" />
<div class="section" id="Goal:-extracting-all-researchers-affiliated-to-a-certain-university,-who-published-in-a-specific-time-frame">
<h1>Goal: extracting all researchers affiliated to a certain university, who published in a specific time-frame<a class="headerlink" href="#Goal:-extracting-all-researchers-affiliated-to-a-certain-university,-who-published-in-a-specific-time-frame" title="Permalink to this headline">¶</a></h1>
<p>The purpose of this notebook is to show how to extract this data using the Dimensions API.</p>
<p>Specifically, we will look at a concrete use case. We want to find out about all reseachers known to Dimensions, who:</p>
<ul class="simple">
<li><p>have an affiliation to <strong>Kyushu Institute of Technology</strong> (<a class="reference external" href="https://grid.ac/institutes/grid.258806.1">grid.258806.1</a>)</p></li>
<li><p>have published in the time frame <strong>2013-2018</strong></p></li>
</ul>
<p>NOTE: something to clarify right away is whether we want affiliations <em>at the time of speaking</em>, <strong>or</strong> <em>at the time of publishing</em>. For the sake of this exercise, we will get both.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[101]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># constants</span>
<span class="n">GRIDID</span> <span class="o">=</span> <span class="s2">&quot;grid.258806.1&quot;</span>
<span class="n">YEARS</span> <span class="o">=</span> <span class="s2">&quot;[2013:2018]&quot;</span>
</pre></div>
</div>
</div>
<div class="section" id="Methodology">
<h2>Methodology<a class="headerlink" href="#Methodology" title="Permalink to this headline">¶</a></h2>
<p>There are 2 ways to tackle this problem.</p>
<div class="section" id="Approach-1.-Starting-from-the-publications-database:">
<h3>Approach 1. Starting from the <em>publications</em> database:<a class="headerlink" href="#Approach-1.-Starting-from-the-publications-database:" title="Permalink to this headline">¶</a></h3>
<ol class="arabic simple">
<li><p>Filter publications for year range [2013-2018] and research_orgs=“grid.258806.1”</p>
<ul class="simple">
<li><p>i.e. <code class="docutils literal notranslate"><span class="pre">search</span> <span class="pre">publications</span> <span class="pre">where</span> <span class="pre">year</span> <span class="pre">in</span> <span class="pre">[2013:2018]</span> <span class="pre">and</span> <span class="pre">research_orgs=&quot;grid.258806.1&quot;</span> <span class="pre">return</span> <span class="pre">publications</span></code></p></li>
</ul>
</li>
<li><p>Loop over publications’ authors and extract relevant reasearchers</p>
<ul class="simple">
<li><p>if <code class="docutils literal notranslate"><span class="pre">['current_organization_id']</span> <span class="pre">==</span> <span class="pre">&quot;grid.258806.1&quot;</span></code></p>
<ul>
<li><p>=&gt; <strong>that gives us the affiliations at the time of speaking</strong></p></li>
</ul>
</li>
<li><p>or if <code class="docutils literal notranslate"><span class="pre">['affiliation']['id']</span> <span class="pre">==</span> <span class="pre">&quot;grid.258806.1&quot;</span></code></p>
<ul>
<li><p>=&gt; <strong>that gives us the affiliations at the time of publishing</strong></p></li>
</ul>
</li>
</ul>
</li>
</ol>
</div>
<div class="section" id="Approach-2.-Starting-from-the-researchers-database:">
<h3>Approach 2. Starting from the <em>researchers</em> database:<a class="headerlink" href="#Approach-2.-Starting-from-the-researchers-database:" title="Permalink to this headline">¶</a></h3>
<ol class="arabic simple">
<li><p>Filter researchers with research_orgs=“grid.258806.1” (note: this gives us affiliated researches <em>at any point in time</em>)</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">search</span> <span class="pre">researchers</span> <span class="pre">where</span> <span class="pre">research_orgs=&quot;grid.258806.1&quot;</span> <span class="pre">return</span> <span class="pre">researchers</span></code></p></li>
</ul>
</li>
<li><p>Search for publications linked to these researchers and linked to “grid.258806.1”, which have been published in the time frame <code class="docutils literal notranslate"><span class="pre">[2013-2018]</span></code></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">search</span> <span class="pre">publications</span> <span class="pre">where</span> <span class="pre">researchers.id</span> <span class="pre">in</span> <span class="pre">{LIST</span> <span class="pre">OF</span> <span class="pre">IDS}</span> <span class="pre">and</span> <span class="pre">year</span> <span class="pre">in</span> <span class="pre">[2013:2018]</span> <span class="pre">and</span> <span class="pre">research_orgs=&quot;grid.258806.1&quot;</span> <span class="pre">return</span> <span class="pre">publications</span></code></p></li>
<li><p>NOTE: this a variation of query 1.1 above: we have just added the researchers IDs filter (thus reducing the search space)</p></li>
</ul>
</li>
<li><p>Extract relevant researchers from publications, using the same exact steps as in 1.2 above</p></li>
</ol>
</div>
</div>
<div class="section" id="Results">
<h2>Results<a class="headerlink" href="#Results" title="Permalink to this headline">¶</a></h2>
<p>As explained in the analysis section, both approaches return the same number of results (with some minor variations). Note: the three figures respectively are the a) researchers affiliated to the organization currently b) at the time of writing and c) and any time.</p>
<table class="docutils align-center">
<colgroup>
<col style="width: 4%" />
<col style="width: 84%" />
<col style="width: 11%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Method</p></th>
<th class="head"><p>Main Query</p></th>
<th class="head"><p>Researchers Found</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>A</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">search</span> <span class="pre">publications</span> <span class="pre">where</span> <span class="pre">year</span> <span class="pre">in</span> <span class="pre">[2013:2018]</span> <span class="pre">and</span> <span class="pre">research_orgs=&quot;grid.258806.1&quot;</span> <span class="pre">return</span> <span class="pre">publications</span></code></p></td>
<td><p>1308 / 1587 / 1588</p></td>
</tr>
<tr class="row-odd"><td><p>B</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">search</span> <span class="pre">researchers</span> <span class="pre">where</span> <span class="pre">research_orgs=&quot;grid.258806.1&quot;</span> <span class="pre">return</span> <span class="pre">researchers</span></code> — then — <code class="docutils literal notranslate"><span class="pre">search</span> <span class="pre">publications</span> <span class="pre">where</span> <span class="pre">researchers.id</span> <span class="pre">in</span> <span class="pre">{IDS}</span> <span class="pre">and</span> <span class="pre">year</span> <span class="pre">in</span> <span class="pre">[2013:2018]</span> <span class="pre">and</span> <span class="pre">research_orgs={GRIDID}</span> <span class="pre">return</span> <span class="pre">publications</span> <span class="pre">limit</span> <span class="pre">1000</span></code></p></td>
<td><p>1309 / 1584 / 1585</p></td>
</tr>
</tbody>
</table>
<div class="section" id="Why-the-different-numbers?">
<h3>Why the different numbers?<a class="headerlink" href="#Why-the-different-numbers?" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>The ‘researchers’ database collects information from both publications and grants data. Hence since some of the results may come from grants, the total number of researchers can be different from publications data.</p></li>
<li><p>The ‘researchers’ database is generated by periodically extracting and disambiguating data from the the publications information and other sources. So sometime it can be less up to date compared to the other databases.</p></li>
</ul>
</div>
<div class="section" id="So-which-one-is-better?">
<h3>So which one is better?<a class="headerlink" href="#So-which-one-is-better?" title="Permalink to this headline">¶</a></h3>
<p>In this case, approach 1 is quicker to implement. However approach 2 could be better in some cases, e.g. if the first publicatons query would return a very large number of results. So it’s good to keep them both in mind and judge case by case.</p>
</div>
</div>
</div>
<hr class="docutils" />
<div class="section" id="Analysis">
<h1>Analysis<a class="headerlink" href="#Analysis" title="Permalink to this headline">¶</a></h1>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[102]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">json</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">from</span> <span class="nn">pandas.io.json</span> <span class="k">import</span> <span class="n">json_normalize</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">tqdm</span> <span class="k">import</span> <span class="n">tnrange</span><span class="p">,</span> <span class="n">tqdm_notebook</span> <span class="k">as</span> <span class="n">bar</span>
<span class="kn">from</span> <span class="nn">time</span> <span class="k">import</span> <span class="n">sleep</span>
<span class="kn">import</span> <span class="nn">dimcli</span>
<span class="kn">from</span> <span class="nn">dimcli.shortcuts</span> <span class="k">import</span> <span class="n">dslquery</span><span class="p">,</span> <span class="n">dslqueryall</span>
<span class="n">dimcli</span><span class="o">.</span><span class="n">login</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
DimCli v0.4.12 - Succesfully connected to &lt;https://app.dimensions.ai&gt; (method: dsl.ini file)
</pre></div></div>
</div>
</div>
<hr class="docutils" />
<div class="section" id="Method-1:-Search-from-publications">
<h1>Method 1: Search from publications<a class="headerlink" href="#Method-1:-Search-from-publications" title="Permalink to this headline">¶</a></h1>
<p>The basic idea of this approach is to get all the relevant publications based on our search criteria. 1. Extract all publications based on the criteria above 2. From each publication, extract all researchers where either the <code class="docutils literal notranslate"><span class="pre">current_organization_id</span></code> or one of the <code class="docutils literal notranslate"><span class="pre">affiliations/id</span></code> are matching the GRIDID 3. Remove duplicate researchers</p>
<p>By looking at one single record we can see how the data is organized: authors are stored in a nested list/dictionary with the key <code class="docutils literal notranslate"><span class="pre">author_affiliations</span></code>. For example, in order to extract for example the second author of the tenth publication we could do the following: <code class="docutils literal notranslate"><span class="pre">res.publications[10]['author_affiliations'][0][1]</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span><span class="s1">&#39;first_name&#39;</span><span class="p">:</span> <span class="s1">&#39;Noboru&#39;</span><span class="p">,</span>
 <span class="s1">&#39;last_name&#39;</span><span class="p">:</span> <span class="s1">&#39;Sebe&#39;</span><span class="p">,</span>
 <span class="s1">&#39;orcid&#39;</span><span class="p">:</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
 <span class="s1">&#39;current_organization_id&#39;</span><span class="p">:</span> <span class="s1">&#39;grid.258806.1&#39;</span><span class="p">,</span>
 <span class="s1">&#39;researcher_id&#39;</span><span class="p">:</span> <span class="s1">&#39;ur.010647607673.28&#39;</span><span class="p">,</span>
 <span class="s1">&#39;affiliations&#39;</span><span class="p">:</span> <span class="p">[{</span><span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="s1">&#39;grid.258806.1&#39;</span><span class="p">,</span>
   <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;Kyushu Institute of Technology&#39;</span><span class="p">,</span>
   <span class="s1">&#39;city&#39;</span><span class="p">:</span> <span class="s1">&#39;Kitakyushu&#39;</span><span class="p">,</span>
   <span class="s1">&#39;city_id&#39;</span><span class="p">:</span> <span class="mi">1859307</span><span class="p">,</span>
   <span class="s1">&#39;country&#39;</span><span class="p">:</span> <span class="s1">&#39;Japan&#39;</span><span class="p">,</span>
   <span class="s1">&#39;country_code&#39;</span><span class="p">:</span> <span class="s1">&#39;JP&#39;</span><span class="p">,</span>
   <span class="s1">&#39;state&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
   <span class="s1">&#39;state_code&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">}]}</span>
</pre></div>
</div>
<p>First off, we can to get all publications based on our search criteria by using a <code class="docutils literal notranslate"><span class="pre">loop</span></code> query.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[103]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">m1_pubs_api_data</span> <span class="o">=</span> <span class="n">dslqueryall</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;&quot;&quot;search publications where year in </span><span class="si">{YEARS}</span><span class="s2"> and research_orgs=&quot;</span><span class="si">{GRIDID}</span><span class="s2">&quot; return publications&quot;&quot;&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
1000 / 4070
2000 / 4070
3000 / 4070
4000 / 4070
4070 / 4070
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[104]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># simplify dict structure nesting PS careful about running this twice!</span>
<span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">m1_pubs_api_data</span><span class="o">.</span><span class="n">publications</span><span class="p">:</span>
    <span class="k">if</span> <span class="s1">&#39;author_affiliations&#39;</span> <span class="ow">in</span> <span class="n">x</span><span class="p">:</span>
        <span class="n">x</span><span class="p">[</span><span class="s1">&#39;author_affiliations&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;author_affiliations&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">x</span><span class="p">[</span><span class="s1">&#39;author_affiliations&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>

<span class="n">m1_authors</span> <span class="o">=</span> <span class="n">json_normalize</span><span class="p">(</span><span class="n">m1_pubs_api_data</span><span class="o">.</span><span class="n">publications</span><span class="p">,</span> <span class="n">record_path</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;author_affiliations&#39;</span><span class="p">],</span> <span class="n">meta</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">],</span> <span class="n">errors</span><span class="o">=</span><span class="s1">&#39;ignore&#39;</span><span class="p">)</span>
<span class="n">m1_authors</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[104]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>affiliations</th>
      <th>current_organization_id</th>
      <th>first_name</th>
      <th>last_name</th>
      <th>orcid</th>
      <th>researcher_id</th>
      <th>id</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>[{'id': 'grid.258806.1', 'name': 'Kyushu Insti...</td>
      <td></td>
      <td>Siewteng</td>
      <td>Sim</td>
      <td></td>
      <td></td>
      <td>pub.1110885950</td>
    </tr>
    <tr>
      <th>1</th>
      <td>[{'id': 'grid.258806.1', 'name': 'Kyushu Insti...</td>
      <td>grid.258806.1</td>
      <td>Yoshito</td>
      <td>Andou</td>
      <td></td>
      <td>ur.01116323260.31</td>
      <td>pub.1110885950</td>
    </tr>
    <tr>
      <th>2</th>
      <td>[{'id': 'grid.11142.37', 'name': 'Universiti P...</td>
      <td>grid.11142.37</td>
      <td>Hamra A. A.</td>
      <td>Bashid</td>
      <td></td>
      <td>ur.016617033322.44</td>
      <td>pub.1110885950</td>
    </tr>
    <tr>
      <th>3</th>
      <td>[{'id': 'grid.11142.37', 'name': 'Universiti P...</td>
      <td>grid.11142.37</td>
      <td>Hongngee</td>
      <td>Lim</td>
      <td>['0000-0003-2436-8953']</td>
      <td>ur.010703155721.11</td>
      <td>pub.1110885950</td>
    </tr>
    <tr>
      <th>4</th>
      <td>[{'id': 'grid.1025.6', 'name': 'Murdoch Univer...</td>
      <td>grid.1025.6</td>
      <td>Mohammednoor</td>
      <td>Altarawneh</td>
      <td></td>
      <td>ur.01137010426.42</td>
      <td>pub.1110885950</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[105]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">m1_authors</span><span class="p">[</span><span class="n">m1_authors</span><span class="p">[</span><span class="s1">&#39;current_organization_id&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">GRIDID</span><span class="p">]</span><span class="o">.</span><span class="n">researcher_id</span><span class="o">.</span><span class="n">nunique</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[105]:
</pre></div>
</div>
<div class="output_area highlight-none notranslate"><div class="highlight"><pre>
<span></span>1308
</pre></div>
</div>
</div>
<p>Now let’s look into the historical affiliations data too.. for that we need to break down the an inner list of dict object. We can simply reuse <code class="docutils literal notranslate"><span class="pre">json_normalize</span></code> for that, by running it again on a JSON version of the authors dataframe.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[106]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">m1_affiliations</span> <span class="o">=</span> <span class="n">json_normalize</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">m1_authors</span><span class="o">.</span><span class="n">to_json</span><span class="p">(</span><span class="n">orient</span><span class="o">=</span><span class="s1">&#39;records&#39;</span><span class="p">)),</span> <span class="n">record_path</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;affiliations&#39;</span><span class="p">],</span>
               <span class="n">meta</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="s1">&#39;researcher_id&#39;</span><span class="p">,</span> <span class="s1">&#39;first_name&#39;</span><span class="p">,</span> <span class="s1">&#39;last_name&#39;</span><span class="p">],</span> <span class="n">record_prefix</span><span class="o">=</span><span class="s1">&#39;aff_&#39;</span><span class="p">)</span>
<span class="n">m1_affiliations</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[106]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>aff_city</th>
      <th>aff_city_id</th>
      <th>aff_country</th>
      <th>aff_country_code</th>
      <th>aff_id</th>
      <th>aff_name</th>
      <th>aff_state</th>
      <th>aff_state_code</th>
      <th>id</th>
      <th>researcher_id</th>
      <th>first_name</th>
      <th>last_name</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Kitakyushu</td>
      <td>1859307.0</td>
      <td>Japan</td>
      <td>JP</td>
      <td>grid.258806.1</td>
      <td>Kyushu Institute of Technology</td>
      <td>None</td>
      <td>None</td>
      <td>pub.1110885950</td>
      <td></td>
      <td>Siewteng</td>
      <td>Sim</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Kitakyushu</td>
      <td>1859307.0</td>
      <td>Japan</td>
      <td>JP</td>
      <td>grid.258806.1</td>
      <td>Kyushu Institute of Technology</td>
      <td>None</td>
      <td>None</td>
      <td>pub.1110885950</td>
      <td>ur.01116323260.31</td>
      <td>Yoshito</td>
      <td>Andou</td>
    </tr>
    <tr>
      <th>2</th>
      <td>Seri Kembangan</td>
      <td>NaN</td>
      <td>Malaysia</td>
      <td>MY</td>
      <td>grid.11142.37</td>
      <td>Universiti Putra Malaysia</td>
      <td>None</td>
      <td>None</td>
      <td>pub.1110885950</td>
      <td>ur.016617033322.44</td>
      <td>Hamra A. A.</td>
      <td>Bashid</td>
    </tr>
    <tr>
      <th>3</th>
      <td>Seri Kembangan</td>
      <td>NaN</td>
      <td>Malaysia</td>
      <td>MY</td>
      <td>grid.11142.37</td>
      <td>Universiti Putra Malaysia</td>
      <td>None</td>
      <td>None</td>
      <td>pub.1110885950</td>
      <td>ur.010703155721.11</td>
      <td>Hongngee</td>
      <td>Lim</td>
    </tr>
    <tr>
      <th>4</th>
      <td>Perth</td>
      <td>2063523.0</td>
      <td>Australia</td>
      <td>AU</td>
      <td>grid.1025.6</td>
      <td>Murdoch University</td>
      <td>Western Australia</td>
      <td>AU-WA</td>
      <td>pub.1110885950</td>
      <td>ur.01137010426.42</td>
      <td>Mohammednoor</td>
      <td>Altarawneh</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<p>How many unique researchers are there (this time based on the affiliation data)?</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[107]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">m1_affiliations</span><span class="p">[</span><span class="n">m1_affiliations</span><span class="p">[</span><span class="s1">&#39;aff_id&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">GRIDID</span><span class="p">]</span><span class="o">.</span><span class="n">researcher_id</span><span class="o">.</span><span class="n">nunique</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[107]:
</pre></div>
</div>
<div class="output_area highlight-none notranslate"><div class="highlight"><pre>
<span></span>1587
</pre></div>
</div>
</div>
<p>How many unique researchers are there, by combining both <code class="docutils literal notranslate"><span class="pre">affiliation</span></code> and <code class="docutils literal notranslate"><span class="pre">current_organization</span></code> data?</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[108]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">m1_researchers</span> <span class="o">=</span> <span class="n">m1_affiliations</span><span class="p">[</span><span class="n">m1_affiliations</span><span class="p">[</span><span class="s1">&#39;aff_id&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">GRIDID</span><span class="p">]</span><span class="o">.</span><span class="n">researcher_id</span>
<span class="n">m1_researchers</span> <span class="o">=</span> <span class="n">m1_researchers</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">m1_authors</span><span class="p">[</span><span class="n">m1_authors</span><span class="p">[</span><span class="s1">&#39;current_organization_id&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">GRIDID</span><span class="p">]</span><span class="o">.</span><span class="n">researcher_id</span><span class="p">)</span>
<span class="c1"># Drop empty values and duplicates</span>
<span class="n">m1_researchers</span> <span class="o">=</span> <span class="n">m1_researchers</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">()</span>
<span class="n">m1_researchers</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Results&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;{m1_researchers.count()} researchers linked to </span><span class="si">{GRIDID}</span><span class="s2"> in total&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Results
1588 researchers linked to grid.258806.1 in total
</pre></div></div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[109]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># finally, save the data locally</span>
<span class="n">m1_authors</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s2">&quot;data/method1_researchers_current_affiliation.csv&quot;</span><span class="p">)</span>
<span class="n">m1_affiliations</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s2">&quot;data/method1_researchers_historical_affiliation.csv&quot;</span><span class="p">)</span>
<span class="n">m1_researchers</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s2">&quot;data/method1_researchers_combined.csv&quot;</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<hr class="docutils" />
<div class="section" id="Method-2:-Search-from-researchers">
<h1>Method 2: Search from researchers<a class="headerlink" href="#Method-2:-Search-from-researchers" title="Permalink to this headline">¶</a></h1>
<p>With this approach, we start our search from the ‘researchers’ database (instead of the ‘publications’ database). 1. First, we extract all researchers affiliated to “grid.258806.1”. 2. Second, we get the publications from these researchers, filtering on the selecter year-range and organization 3. Third, we pull out all relevant researchers from the publications list</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[110]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">m2_researchers_api_data</span> <span class="o">=</span> <span class="n">dslqueryall</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;&quot;&quot;search researchers where research_orgs=&quot;</span><span class="si">{GRIDID}</span><span class="s2">&quot; return researchers[all]&quot;&quot;&quot;</span><span class="p">)</span>
<span class="n">m2_researchers_for_grid</span> <span class="o">=</span> <span class="n">m2_researchers_api_data</span><span class="o">.</span><span class="n">as_dataframe</span><span class="p">()</span>
<span class="n">m2_researchers_for_grid</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
1000 / 6752
2000 / 6752
3000 / 6752
4000 / 6752
5000 / 6752
6000 / 6752
6752 / 6752
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[110]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>current_research_org</th>
      <th>first_grant_year</th>
      <th>first_name</th>
      <th>first_publication_year</th>
      <th>id</th>
      <th>last_grant_year</th>
      <th>last_name</th>
      <th>last_publication_year</th>
      <th>obsolete</th>
      <th>orcid_id</th>
      <th>redirect</th>
      <th>research_orgs</th>
      <th>total_grants</th>
      <th>total_publications</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>{'id': 'grid.258806.1', 'acronym': 'KIT', 'nam...</td>
      <td>1997.0</td>
      <td>Tetsuji</td>
      <td>1992.0</td>
      <td>ur.013506011335.42</td>
      <td>2018.0</td>
      <td>Moriguchi</td>
      <td>2018.0</td>
      <td>0</td>
      <td>[0000-0002-2362-0590]</td>
      <td>NaN</td>
      <td>[{'id': 'grid.258806.1', 'acronym': 'KIT', 'na...</td>
      <td>10</td>
      <td>99</td>
    </tr>
    <tr>
      <th>1</th>
      <td>NaN</td>
      <td>NaN</td>
      <td>Ivan</td>
      <td>1991.0</td>
      <td>ur.01306536423.46</td>
      <td>NaN</td>
      <td>Godler</td>
      <td>2017.0</td>
      <td>1</td>
      <td>NaN</td>
      <td>[ur.012100442163.84]</td>
      <td>[{'id': 'grid.412586.c', 'name': 'The Universi...</td>
      <td>0</td>
      <td>50</td>
    </tr>
    <tr>
      <th>2</th>
      <td>NaN</td>
      <td>NaN</td>
      <td>Ivan</td>
      <td>1991.0</td>
      <td>ur.012424620305.51</td>
      <td>NaN</td>
      <td>Godler</td>
      <td>2017.0</td>
      <td>1</td>
      <td>NaN</td>
      <td>[ur.012100442163.84]</td>
      <td>[{'id': 'grid.412586.c', 'name': 'The Universi...</td>
      <td>0</td>
      <td>50</td>
    </tr>
    <tr>
      <th>3</th>
      <td>NaN</td>
      <td>NaN</td>
      <td>Ivan</td>
      <td>1991.0</td>
      <td>ur.010716033531.51</td>
      <td>NaN</td>
      <td>Godler</td>
      <td>2017.0</td>
      <td>1</td>
      <td>NaN</td>
      <td>[ur.012100442163.84]</td>
      <td>[{'id': 'grid.412586.c', 'name': 'The Universi...</td>
      <td>0</td>
      <td>50</td>
    </tr>
    <tr>
      <th>4</th>
      <td>{'id': 'grid.258806.1', 'acronym': 'KIT', 'nam...</td>
      <td>NaN</td>
      <td>Daisuke</td>
      <td>2005.0</td>
      <td>ur.015547663323.73</td>
      <td>NaN</td>
      <td>Makino</td>
      <td>2006.0</td>
      <td>0</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>[{'id': 'grid.258806.1', 'acronym': 'KIT', 'na...</td>
      <td>0</td>
      <td>2</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<p>Now we need to select only the researchers who have published in the time frame [2013:2018]. So for each researcher ID we must extract the full publication history in order to verify their relevance.</p>
<p>The most efficient way to do this is to use a query that <strong>extracts the publication history for several researchers at the same time</strong> (so to avoid overruning our API quota), then, as a second step, producing a clean list of relevant researchers from it.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[111]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">m2_pubs_for_researchers</span> <span class="o">=</span> <span class="p">[]</span>

<span class="k">def</span> <span class="nf">get_pubs_from_ids</span><span class="p">(</span><span class="n">ids_list</span><span class="p">):</span>
    <span class="n">IDS</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">ids_list</span><span class="p">)</span>
    <span class="n">q</span> <span class="o">=</span> <span class="n">f</span><span class="s2">&quot;&quot;&quot;search publications</span>
<span class="s2">                where researchers.id in </span><span class="si">{IDS}</span><span class="s2"></span>
<span class="s2">                and year in </span><span class="si">{YEARS}</span><span class="s2"></span>
<span class="s2">                and research_orgs=&quot;</span><span class="si">{GRIDID}</span><span class="s2">&quot;</span>
<span class="s2">            return publications limit 1000&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">dslquery</span><span class="p">(</span><span class="n">q</span><span class="p">)</span>

<span class="n">CHUNKS_SIZE</span> <span class="o">=</span> <span class="mi">300</span> <span class="c1"># to ensure we never hit the 1000 limit</span>

<span class="k">for</span> <span class="n">chunk</span> <span class="ow">in</span> <span class="n">m2_researchers_api_data</span><span class="o">.</span><span class="n">chunks</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="n">CHUNKS_SIZE</span><span class="p">):</span>
    <span class="n">ids</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">chunk</span><span class="p">]</span>
    <span class="n">temp</span> <span class="o">=</span> <span class="n">get_pubs_from_ids</span><span class="p">(</span><span class="n">ids</span><span class="p">)</span>
    <span class="n">m2_pubs_for_researchers</span> <span class="o">+=</span> <span class="n">temp</span><span class="o">.</span><span class="n">publications</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">temp</span><span class="p">[</span><span class="s1">&#39;stats&#39;</span><span class="p">])</span> <span class="c1"># visual check</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;---</span><span class="se">\n</span><span class="s2">Found&quot;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">m2_pubs_for_researchers</span><span class="p">),</span> <span class="s2">&quot;publications for the given criteria (including duplicates)&quot;</span><span class="p">)</span>

<span class="n">idx</span><span class="p">,</span> <span class="n">m2_pubs_for_researchers_unique</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">m2_pubs_for_researchers</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">idx</span><span class="p">:</span>
        <span class="n">idx</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">])</span>
        <span class="n">m2_pubs_for_researchers_unique</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>

        <span class="nb">len</span><span class="p">(</span><span class="n">m2_pubs_for_researchers_unique</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Final result:&quot;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">m2_pubs_for_researchers_unique</span><span class="p">),</span> <span class="s2">&quot;unique publications&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
{&#39;total_count&#39;: 318, &#39;limit&#39;: 1000, &#39;offset&#39;: 0}
{&#39;total_count&#39;: 396, &#39;limit&#39;: 1000, &#39;offset&#39;: 0}
{&#39;total_count&#39;: 388, &#39;limit&#39;: 1000, &#39;offset&#39;: 0}
{&#39;total_count&#39;: 601, &#39;limit&#39;: 1000, &#39;offset&#39;: 0}
{&#39;total_count&#39;: 269, &#39;limit&#39;: 1000, &#39;offset&#39;: 0}
{&#39;total_count&#39;: 404, &#39;limit&#39;: 1000, &#39;offset&#39;: 0}
{&#39;total_count&#39;: 310, &#39;limit&#39;: 1000, &#39;offset&#39;: 0}
{&#39;total_count&#39;: 503, &#39;limit&#39;: 1000, &#39;offset&#39;: 0}
{&#39;total_count&#39;: 268, &#39;limit&#39;: 1000, &#39;offset&#39;: 0}
{&#39;total_count&#39;: 308, &#39;limit&#39;: 1000, &#39;offset&#39;: 0}
{&#39;total_count&#39;: 414, &#39;limit&#39;: 1000, &#39;offset&#39;: 0}
{&#39;total_count&#39;: 659, &#39;limit&#39;: 1000, &#39;offset&#39;: 0}
{&#39;total_count&#39;: 390, &#39;limit&#39;: 1000, &#39;offset&#39;: 0}
{&#39;total_count&#39;: 451, &#39;limit&#39;: 1000, &#39;offset&#39;: 0}
{&#39;total_count&#39;: 298, &#39;limit&#39;: 1000, &#39;offset&#39;: 0}
{&#39;total_count&#39;: 494, &#39;limit&#39;: 1000, &#39;offset&#39;: 0}
{&#39;total_count&#39;: 334, &#39;limit&#39;: 1000, &#39;offset&#39;: 0}
{&#39;total_count&#39;: 395, &#39;limit&#39;: 1000, &#39;offset&#39;: 0}
{&#39;total_count&#39;: 321, &#39;limit&#39;: 1000, &#39;offset&#39;: 0}
{&#39;total_count&#39;: 479, &#39;limit&#39;: 1000, &#39;offset&#39;: 0}
{&#39;total_count&#39;: 402, &#39;limit&#39;: 1000, &#39;offset&#39;: 0}
{&#39;total_count&#39;: 269, &#39;limit&#39;: 1000, &#39;offset&#39;: 0}
{&#39;total_count&#39;: 121, &#39;limit&#39;: 1000, &#39;offset&#39;: 0}
---
Found 8792 publications for the given criteria (including duplicates)
Final result: 3809 unique publications
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[112]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># simplify dict structure like above /  PS careful about running this twice!</span>
<span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">m2_pubs_for_researchers</span><span class="p">:</span>
    <span class="k">if</span> <span class="s1">&#39;author_affiliations&#39;</span> <span class="ow">in</span> <span class="n">x</span><span class="p">:</span>
        <span class="n">x</span><span class="p">[</span><span class="s1">&#39;author_affiliations&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;author_affiliations&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">x</span><span class="p">[</span><span class="s1">&#39;author_affiliations&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>

<span class="n">m2_pubs_authors</span> <span class="o">=</span> <span class="n">json_normalize</span><span class="p">(</span><span class="n">m2_pubs_for_researchers_unique</span><span class="p">,</span> <span class="n">record_path</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;author_affiliations&#39;</span><span class="p">],</span> <span class="n">meta</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">],</span> <span class="n">errors</span><span class="o">=</span><span class="s1">&#39;ignore&#39;</span><span class="p">)</span>
<span class="n">m2_pubs_authors</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[112]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>affiliations</th>
      <th>current_organization_id</th>
      <th>first_name</th>
      <th>last_name</th>
      <th>orcid</th>
      <th>researcher_id</th>
      <th>id</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>[{'id': 'grid.8536.8', 'name': 'Federal Univer...</td>
      <td></td>
      <td>C. C.</td>
      <td>Soares</td>
      <td></td>
      <td></td>
      <td>pub.1103719897</td>
    </tr>
    <tr>
      <th>1</th>
      <td>[{'id': 'grid.8536.8', 'name': 'Federal Univer...</td>
      <td>grid.8536.8</td>
      <td>M.</td>
      <td>ElMassalami</td>
      <td>['0000-0003-3543-1946']</td>
      <td>ur.01175272515.05</td>
      <td>pub.1103719897</td>
    </tr>
    <tr>
      <th>2</th>
      <td>[{'id': 'grid.21941.3f', 'name': 'National Ins...</td>
      <td>grid.21941.3f</td>
      <td>Y.</td>
      <td>Yanagisawa</td>
      <td></td>
      <td>ur.013116001105.24</td>
      <td>pub.1103719897</td>
    </tr>
    <tr>
      <th>3</th>
      <td>[{'id': 'grid.21941.3f', 'name': 'National Ins...</td>
      <td>grid.258806.1</td>
      <td>M.</td>
      <td>Tanaka</td>
      <td>['0000-0002-4323-5999']</td>
      <td>ur.014310336431.75</td>
      <td>pub.1103719897</td>
    </tr>
    <tr>
      <th>4</th>
      <td>[{'id': 'grid.21941.3f', 'name': 'National Ins...</td>
      <td>grid.21941.3f</td>
      <td>H.</td>
      <td>Takeya</td>
      <td></td>
      <td>ur.010212206615.18</td>
      <td>pub.1103719897</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[113]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">m2_pubs_authors</span><span class="p">[</span><span class="n">m2_pubs_authors</span><span class="p">[</span><span class="s1">&#39;current_organization_id&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">GRIDID</span><span class="p">]</span><span class="o">.</span><span class="n">researcher_id</span><span class="o">.</span><span class="n">nunique</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[113]:
</pre></div>
</div>
<div class="output_area highlight-none notranslate"><div class="highlight"><pre>
<span></span>1309
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[114]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">m2_affiliations</span> <span class="o">=</span> <span class="n">json_normalize</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">m2_pubs_authors</span><span class="o">.</span><span class="n">to_json</span><span class="p">(</span><span class="n">orient</span><span class="o">=</span><span class="s1">&#39;records&#39;</span><span class="p">)),</span> <span class="n">record_path</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;affiliations&#39;</span><span class="p">],</span>
               <span class="n">meta</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="s1">&#39;researcher_id&#39;</span><span class="p">,</span> <span class="s1">&#39;first_name&#39;</span><span class="p">,</span> <span class="s1">&#39;last_name&#39;</span><span class="p">],</span> <span class="n">record_prefix</span><span class="o">=</span><span class="s1">&#39;aff_&#39;</span><span class="p">)</span>
<span class="n">m2_affiliations</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[114]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>aff_city</th>
      <th>aff_city_id</th>
      <th>aff_country</th>
      <th>aff_country_code</th>
      <th>aff_id</th>
      <th>aff_name</th>
      <th>aff_state</th>
      <th>aff_state_code</th>
      <th>id</th>
      <th>researcher_id</th>
      <th>first_name</th>
      <th>last_name</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Rio de Janeiro</td>
      <td>3451190.0</td>
      <td>Brazil</td>
      <td>BR</td>
      <td>grid.8536.8</td>
      <td>Federal University of Rio de Janeiro</td>
      <td>None</td>
      <td>None</td>
      <td>pub.1103719897</td>
      <td></td>
      <td>C. C.</td>
      <td>Soares</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Rio de Janeiro</td>
      <td>3451190.0</td>
      <td>Brazil</td>
      <td>BR</td>
      <td>grid.8536.8</td>
      <td>Federal University of Rio de Janeiro</td>
      <td>None</td>
      <td>None</td>
      <td>pub.1103719897</td>
      <td>ur.01175272515.05</td>
      <td>M.</td>
      <td>ElMassalami</td>
    </tr>
    <tr>
      <th>2</th>
      <td>Tsukuba</td>
      <td>2110683.0</td>
      <td>Japan</td>
      <td>JP</td>
      <td>grid.21941.3f</td>
      <td>National Institute for Materials Science</td>
      <td>None</td>
      <td>None</td>
      <td>pub.1103719897</td>
      <td>ur.013116001105.24</td>
      <td>Y.</td>
      <td>Yanagisawa</td>
    </tr>
    <tr>
      <th>3</th>
      <td>Tsukuba</td>
      <td>2110683.0</td>
      <td>Japan</td>
      <td>JP</td>
      <td>grid.21941.3f</td>
      <td>National Institute for Materials Science</td>
      <td>None</td>
      <td>None</td>
      <td>pub.1103719897</td>
      <td>ur.014310336431.75</td>
      <td>M.</td>
      <td>Tanaka</td>
    </tr>
    <tr>
      <th>4</th>
      <td>Kitakyushu</td>
      <td>1859307.0</td>
      <td>Japan</td>
      <td>JP</td>
      <td>grid.258806.1</td>
      <td>Kyushu Institute of Technology</td>
      <td>None</td>
      <td>None</td>
      <td>pub.1103719897</td>
      <td>ur.014310336431.75</td>
      <td>M.</td>
      <td>Tanaka</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<p>How many unique researchers are there (this time based on the affiliation data)?</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[115]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">m2_affiliations</span><span class="p">[</span><span class="n">m2_affiliations</span><span class="p">[</span><span class="s1">&#39;aff_id&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">GRIDID</span><span class="p">]</span><span class="o">.</span><span class="n">researcher_id</span><span class="o">.</span><span class="n">nunique</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[115]:
</pre></div>
</div>
<div class="output_area highlight-none notranslate"><div class="highlight"><pre>
<span></span>1584
</pre></div>
</div>
</div>
<p>How many unique researchers are there, by combining both <code class="docutils literal notranslate"><span class="pre">affiliation</span></code> and <code class="docutils literal notranslate"><span class="pre">current_organization</span></code> data?</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[116]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">m2_researchers</span> <span class="o">=</span> <span class="n">m2_affiliations</span><span class="p">[</span><span class="n">m2_affiliations</span><span class="p">[</span><span class="s1">&#39;aff_id&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">GRIDID</span><span class="p">]</span><span class="o">.</span><span class="n">researcher_id</span>
<span class="n">m2_researchers</span> <span class="o">=</span> <span class="n">m2_researchers</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">m2_pubs_authors</span><span class="p">[</span><span class="n">m2_pubs_authors</span><span class="p">[</span><span class="s1">&#39;current_organization_id&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">GRIDID</span><span class="p">]</span><span class="o">.</span><span class="n">researcher_id</span><span class="p">)</span>
<span class="c1"># Drop empty values and duplicates</span>
<span class="n">m2_researchers</span> <span class="o">=</span> <span class="n">m2_researchers</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">()</span>
<span class="n">m2_researchers</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Results&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;{m2_researchers.count()} researchers linked to </span><span class="si">{GRIDID}</span><span class="s2"> in total&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Results
1585 researchers linked to grid.258806.1 in total
</pre></div></div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[117]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># finally, save the data locally</span>
<span class="n">m2_pubs_authors</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s2">&quot;data/method2_researchers_current_affiliation.csv&quot;</span><span class="p">)</span>
<span class="n">m2_affiliations</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s2">&quot;data/method2_researchers_historical_affiliation.csv&quot;</span><span class="p">)</span>
<span class="n">m2_researchers</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s2">&quot;data/method2_researchers_combined.csv&quot;</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<hr class="docutils" />
<div class="section" id="Want-to-learn-more?">
<h1>Want to learn more?<a class="headerlink" href="#Want-to-learn-more?" title="Permalink to this headline">¶</a></h1>
<p>Check out the <a class="reference external" href="https://digital-science.github.io/dimensions-api-lab/">Dimensions API Lab</a> website, which contains many tutorials and reusable Jupyter notebooks for scholarly data analytics.</p>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
<hr class="docutils" />
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>You can open an interactive version of this notebook in <a class="reference external" href="https://colab.research.google.com/github/digital-science/dimensions-api-lab/blob/master/notebooks/researchers/Researchers-Search-tips.ipynb">Google Colab</a>, or download its source from <a class="reference external" href="https://digital-science.github.io/dimensions-api-lab/blob/master/notebooks/researchers/Researchers-Search-tips.ipynb">Github</a>.</p>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="../../index.html">Table of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Goal: extracting all researchers affiliated to a certain university, who published in a specific time-frame</a><ul>
<li><a class="reference internal" href="#Methodology">Methodology</a><ul>
<li><a class="reference internal" href="#Approach-1.-Starting-from-the-publications-database:">Approach 1. Starting from the <em>publications</em> database:</a></li>
<li><a class="reference internal" href="#Approach-2.-Starting-from-the-researchers-database:">Approach 2. Starting from the <em>researchers</em> database:</a></li>
</ul>
</li>
<li><a class="reference internal" href="#Results">Results</a><ul>
<li><a class="reference internal" href="#Why-the-different-numbers?">Why the different numbers?</a></li>
<li><a class="reference internal" href="#So-which-one-is-better?">So which one is better?</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#Analysis">Analysis</a></li>
<li><a class="reference internal" href="#Method-1:-Search-from-publications">Method 1: Search from publications</a></li>
<li><a class="reference internal" href="#Method-2:-Search-from-researchers">Method 2: Search from researchers</a></li>
<li><a class="reference internal" href="#Want-to-learn-more?">Want to learn more?</a></li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="../getting-started/4-Using-Dimcli-to-return-pandas-dataframes.html"
                        title="previous chapter">Working with Pandas dataframes</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="../organizations/GRID-preview.html"
                        title="next chapter">Searching GRID organizations using the Dimensions API</a></p>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../../_sources/notebooks/researchers/Researchers-Search-tips.ipynb.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../organizations/GRID-preview.html" title="Searching GRID organizations using the Dimensions API"
             >next</a> |</li>
        <li class="right" >
          <a href="../getting-started/4-Using-Dimcli-to-return-pandas-dataframes.html" title="Working with Pandas dataframes"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">Dimensions API Lab - Reusable Code Solutions</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2019, Dimensions API Team.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 2.0.1.
    </div>
  </body>
</html>